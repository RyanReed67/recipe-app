<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Recipe Manager</title>
    <link rel="stylesheet" href="/styles.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Recipe Master List</h1>

        <form id="recipeForm">
            <div class="section">
                <input type="text" id="title" placeholder="Recipe Title" required>
                <textarea id="description" placeholder="Short description..."></textarea>
            </div>

            <div id="ingredient-section" class="section">
                <h3>Ingredients</h3>
                <div id="ingredient-list">
                    <div class="ingredient-row">
                        <input type="text" class="ing-name" placeholder="Name (e.g. Flour)" required>
                        <input type="text" class="ing-amount" placeholder="Qty (e.g. 1 cup)" required>
                    </div>
                </div>
                <button type="button" id="addIngredient" class="btn-small">+ Add Ingredient</button>
            </div>

            <div id="instruction-section" class="section">
                <h3>Instructions</h3>
                <div id="instruction-list">
                    <div class="instruction-row">
                        <input type="text" class="step-text" placeholder="Step 1..." required>
                    </div>
                </div>
                <button type="button" id="addStep" class="btn-small">+ Add Step</button>
            </div>

            <button type="submit" class="btn-save">Save Full Recipe</button>
        </form>

        <hr>

        <div id="recipeList">
            <h2>Saved Recipes</h2>
            <% recipes.forEach(recipe => { %>
                <div class="card">
                    <h3><%= recipe.title %></h3>
                    <p><%= recipe.description %></p>
                </div>
            <% }) %>
        </div>
    </div>

    <script>
      $(document).ready(function() {
        $("#addIngredient").on("click", function() {
          $("#ingredient-list").append(`
          <div class="ingredient-row">
            <input type="text" class="ing-name" placeholder="Name" required>
            <input type="number" class="ing-amount" placeholder="Qty" step="0.01" required>
            <button type="button" class="remove-btn">x</button>
            </div>
            `);
        });
$(document).ready(function() {
    $("#addIngredient").on("click", function() {
        $("#ingredient-list").append(`
            <div class="ingredient-row">
                <input type="text" class="ing-name" placeholder="Name" required>
                <input type="text" class="ing-amount" placeholder="Qty" required>
                <button type="button" class="remove-btn">x</button>
            </div>
        `);
    });

    $(document).on("click", ".remove-btn", function() {
        $(this).parent().remove();
    });

    $("#recipeForm").on("submit", function(e) {
        e.preventDefault();

        const ingredients = [];
        $(".ingredient-row").each(function() {
            ingredients.push({
                name: $(this).find(".ing-name").val(),
                amount: $(this).find(".ing-amount").val() 
            });
        });

        const instructions = [];
        $(".step-text").each(function() {
            instructions.push($(this).val());
        });

        const recipeData = {
            title: $("#title").val(),
            description: $("#description").val(),
            ingredients: ingredients,
            instructions: instructions
        };

        $.ajax({
            url: "/add-recipe",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(recipeData),
            success: function(response) {
                alert("Recipe saved!");
                location.reload();
            },
            error: function() { alert("Error saving recipe."); }
        });
    });
});
      });
    </script>
</body>
</html>
